
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solo Leveling ‚Äî Weekly Gate v3.4.0</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <meta name="theme-color" content="#0f1222" />
  <style>
    :root{ --bg:#0f1222; --panel:#171a2e; --text:#e8edff; --muted:#a9b0d6; --accent:#6aa9ff; --accent2:#7bffb8; --danger:#ff6a6a; --border:#2a2f57 }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    header{position:sticky;top:0;z-index:8;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#121636,#0f1222);display:flex;align-items:center;gap:10px}
    h1{margin:0;font-size:18px;letter-spacing:.2px;color:var(--accent)}
    .ver{color:#a9b0d6;font-size:12px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:#171a2e;border:1px solid var(--border);border-radius:14px;padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--accent);color:#041021;border:none;border-radius:12px;padding:14px 18px;font-weight:900;cursor:pointer}
    .btn.secondary{background:#2a2f57;color:var(--text)}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:#a9b0d6}

    /* floating add dock */
    .follow-dock{position:fixed;left:50%;bottom:calc(12px + env(safe-area-inset-bottom));transform:translateX(-50%);z-index:10}
    .dock-inner{display:flex;gap:10px;background:rgba(16,20,42,.9);border:1px solid var(--border);border-radius:16px;padding:10px 12px;backdrop-filter:blur(8px)}
    .cta{display:flex;align-items:center;justify-content:center;padding:14px 16px;border-radius:12px;border:2px solid var(--accent);background:linear-gradient(180deg,#1a2044,#10142a);font-size:16px;font-weight:900;text-transform:uppercase;cursor:pointer}

    .gate{font-size:24px;font-weight:900}
    .gate.closed{color:#ff9aa8}
    .gate.open{color:#7bffb8}

    .quote{background:linear-gradient(180deg,#121636,#10142a);border:1px solid var(--border);margin-bottom:16px}
    .quote blockquote{margin:0;text-align:center;line-height:1.65}
    .quote .zh{font-size:22px;letter-spacing:.05em;font-family:"Noto Sans JP","Microsoft YaHei","WenQuanYi Zen Hei",system-ui,sans-serif}
    .quote .en{margin-top:8px;color:#cfd6ff;font-size:15px;font-style:italic}

    .wmq{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .qchip{grid-column: span 12;background:#10142e;border:1px solid var(--border);border-radius:12px;padding:12px}
    @media(min-width:700px){ .qchip{grid-column: span 6} }
    @media(min-width:1000px){ .qchip{grid-column: span 4} }
    .qtitle{display:flex;align-items:center;gap:8px;font-weight:800}
    .qbar{height:10px;border-radius:999px;background:#0e1126;border:1px solid var(--border);overflow:hidden;margin-top:8px}
    .qbar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}
    .qdone{color:#7bffb8}

    .cal{display:grid;grid-template-columns:repeat(7,minmax(44px,1fr));gap:6px}
    .cal .head{font-size:12px;color:#a9b0d6;text-align:center}
    .day{display:flex;flex-direction:column;align-items:flex-end;justify-content:space-between;border:1px solid var(--border);border-radius:10px;min-height:72px;padding:6px;background:#10142e;color:var(--text);cursor:pointer}
    .day .d{font-size:12px;color:#a9b0d6;align-self:flex-start}
    .mark{align-self:flex-end;border-radius:999px;padding:2px 6px;font-size:11px;border:1px solid var(--border)}

    input,select,textarea{width:100%;background:#0e1126;color:#fff;border:1px solid var(--border);border-radius:8px;padding:10px 12px;font:inherit}
    footer{color:#a9b0d6;font-size:12px;padding:24px;text-align:center}

    /* Live session UI */
    .chipset{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#10142a;cursor:pointer}
    .chip.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(106,169,255,.25) inset}
    .exlist{margin-top:8px;border:1px solid var(--border);border-radius:12px;padding:10px;background:#10142a}
    .sets{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
    .set{background:#0f193a;color:#e8edff;border:1px solid #2a2f57;border-radius:999px;padding:2px 8px;font-size:12px}
    .badge{font-size:12px;color:#a9b0d6}
  </style>
</head>
<body>
  <header>
    <h1>Solo Leveling ‚Äî Weekly Gate</h1>
    <span class="ver">v3.4.0</span>
  </header>

  <div class="wrap" id="wrapRoot">
    <!-- Quote at top -->
    <div class="card quote" id="qcard">
      <blockquote>
        <div class="en">"I will continue fighting myself, as long as I have fangs in my heart."</div>
        <div class="zh" lang="ja">Â∑±„ÅÆÁîü„Å´<br>Êäó„ÅÑÁ∂ö„Åë„Çã<br>Â∑±„ÅÆÂøÉ„Å´<br>Áâô„ÅÇ„ÇãÈôê„Çä</div>
      </blockquote>
    </div>

    <!-- Stats -->
    <div class="grid" style="margin-top:12px">
      <div class="card" style="grid-column: span 3"><div style="color:#a9b0d6">Levels Cleared</div><div style="font-size:24px;font-weight:800" id="levelsCleared">0</div></div>
      <div class="card" style="grid-column: span 9"><div style="color:#a9b0d6">Gate</div><div class="gate closed" id="gateStatus">Gate Closed ‚õî</div></div>
    </div>

    <!-- Weekly Main Quests -->
    <div class="card" id="weeklyCard">
      <h3 style="margin:0 0 8px">Weekly Main Quests</h3>
      <div class="wmq" id="wmq"></div>
      <div class="row" style="margin-top:8px;align-items:center">
        <span>Week: <span id="weekRange"></span></span>
        <span style="margin-left:auto">This Week EXP: <b id="weekExp">0</b> ‚Ä¢ Total EXP: <b id="totalExp">0</b></span>
      </div>
    </div>

    <!-- Clean Boy -->
    <div class="card" id="cleanCard">
      <h3 style="margin:0 0 6px">ü•ó Clean Boy (Daily)</h3>
      <div class="row">
        <input type="date" id="qDate">
        <label>Ate clean <input type="checkbox" id="qClean"></label>
        <label>Water (L) <input type="number" id="qWater" min="0" step="0.1" placeholder="2.0"></label>
        <button class="btn" id="qSave">Save Day</button>
      </div>
      <div class="row" style="margin-top:6px">
        <button class="btn ghost" data-ml="100">+100 ml</button>
        <button class="btn ghost" data-ml="250">+250 ml</button>
        <button class="btn ghost" data-ml="330">+330 ml</button>
        <button class="btn ghost" data-ml="500">+500 ml</button>
        <button class="btn ghost" id="waterCustomBtn">+ custom</button>
        <div style="margin-left:auto">Target: <span id="waterTargetLbl">2.0</span> L</div>
      </div>
      <div style="margin:8px 0">Hydration progress</div>
      <div style="height:10px;border-radius:8px;background:#0e1126;border:1px solid var(--border);overflow:hidden"><span id="waterBar" style="display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%"></span></div>
      <div class="row" style="margin-top:8px"><div>This month: <b id="qMonthCount">0</b> CB days</div><div>Current streak: <b id="qStreak">0</b> days</div><div>Best streak: <b id="qBest">0</b> days</div></div>
      <div class="row" style="align-items:center;gap:8px;margin-top:10px">
        <button class="btn secondary" id="prevMonth">‚óÄ</button>
        <b id="calTitle">Month YYYY</b>
        <button class="btn secondary" id="nextMonth">‚ñ∂</button>
      </div>
      <div class="cal" id="calHead"></div>
      <div class="cal" id="calGrid"></div>
    </div>

    <footer>
      <button class="btn secondary" id="settingsBtn">‚öôÔ∏è Settings</button>
    </footer>
  </div>

  <!-- Floating Add Dock -->
  <div class="follow-dock" aria-hidden="false">
    <div class="dock-inner">
      <button class="cta" id="ctaWorkout">‚ûï Add Workout</button>
      <button class="cta" id="ctaChore">‚ûï Add Chore</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:99" aria-hidden="true">
    <div class="sheet" style="width:min(560px,92%);background:#0f1222;border:1px solid var(--border);border-radius:16px;padding:16px">
      <h3 style="margin:0 0 10px">Settings</h3>
      <div class="row"><label>Base Workout EXP <input id="cfgBaseWorkout" type="number" value="50"></label><label>Base Chore EXP <input id="cfgBaseChore" type="number" value="20"></label></div>
      <div class="row"><label>EXP per Workout Minute <input id="cfgPerMin" type="number" value="2"></label><label>Hydration target (L/day) <input id="cfgWaterTarget" type="number" step="0.1" value="2.0"></label></div>
      <div class="row"><button class="btn" id="saveCfg">Save</button><button class="btn secondary" id="closeSettings">Close</button></div>
    </div>
  </div>

  <!-- Workout Modal (Quick + Live) -->
  <div class="modal" id="workoutModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:99" aria-hidden="true">
    <div class="sheet" style="width:min(720px,94%);background:#0f1222;border:1px solid var(--border);border-radius:16px;padding:16px">
      <h3 style="margin:0 0 10px">‚ûï Add workout</h3>

      <!-- Tabs -->
      <div class="chipset" id="wTabs">
        <span class="chip active" data-tab="quick">Quick Add</span>
        <span class="chip" data-tab="live">Live Session</span>
      </div>

      <!-- Quick Add pane -->
      <div id="paneQuick">
        <div class="row" style="margin-top:8px"><label>Minutes <input id="mWMin" type="number" min="0" value="30"></label><label>Sets <input id="mWSets" type="number" min="0" value="0"></label><label>Intensity (1‚Äë5) <select id="mWInt"><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option></select></label></div>
        <div class="row"><button class="btn" id="mWSave">Add Workout</button><button class="btn secondary" id="mWClose">Cancel</button></div>
      </div>

      <!-- Live Session pane -->
      <div id="paneLive" style="display:none">
        <div class="badge">Choose muscle group to start:</div>
        <div class="chipset" id="muscleChips" style="margin:6px 0 8px">
          <span class="chip" data-m="Back">Back</span>
          <span class="chip" data-m="Chest">Chest</span>
          <span class="chip" data-m="Legs">Legs</span>
          <span class="chip" data-m="Shoulders">Shoulders</span>
          <span class="chip" data-m="Arms">Arms</span>
          <span class="chip" data-m="Full Body">Full Body</span>
        </div>
        <div id="liveBox" style="display:none" class="exlist">
          <div class="row">
            <label style="flex:2">Exercise <select id="liveEx"></select></label>
            <label style="flex:1">Weight (kg) <input id="liveKg" type="number" min="0" step="0.5" value="40"></label>
            <label style="flex:1">Reps <input id="liveReps" type="number" min="1" step="1" value="8"></label>
            <button class="btn" id="addSetBtn" style="flex:0 0 auto">Add Set</button>
          </div>
          <div class="sets" id="setsBox"></div>
          <div class="row" style="margin-top:10px">
            <div class="badge">Total sets: <b id="liveTotalSets">0</b> ‚Ä¢ Volume: <b id="liveVolume">0</b> kg</div>
            <button class="btn" id="finishLiveBtn" style="margin-left:auto">Finish & Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chore Modal (checkboxes) -->
  <div class="modal" id="choreModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:99" aria-hidden="true">
    <div class="sheet" style="width:min(540px,92%);background:#0f1222;border:1px solid var(--border);border-radius:16px;padding:16px">
      <h3 style="margin:0 0 10px">‚ûï Add chores / reading</h3>
      <div class="row" style="gap:8px">
        <label><input type="checkbox" id="cVac"> Vacuum</label>
        <label><input type="checkbox" id="cSweep"> Sweep</label>
        <label><input type="checkbox" id="cDust"> Dust</label>
        <label><input type="checkbox" id="cBath"> Bathroom</label>
        <label><input type="checkbox" id="cRead"> Reading</label>
      </div>
      <div class="row"><label>Minutes (optional total) <input id="mCMin" type="number" min="0" value="20"></label></div>
      <div class="row"><button class="btn" id="mCSave">Add</button><button class="btn secondary" id="mCClose">Cancel</button></div>
    </div>
  </div>

  <script src="app.js?v=340"></script>
  <script>
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('service-worker.js?v=340'); }); }
  </script>
</body>
</html>
