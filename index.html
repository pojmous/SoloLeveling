
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solo Leveling â€” Weekly Gate (v3.2.1)</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <meta name="theme-color" content="#0f1222" />
  <style>
    :root{ --bg:#0f1222; --panel:#171a2e; --text:#e8edff; --muted:#a9b0d6; --accent:#6aa9ff; --accent2:#7bffb8; --danger:#ff6a6a; --border:#2a2f57; --dim: .35 }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    header{position:sticky;top:0;z-index:8;padding:16px 20px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#121636,#0f1222)}
    h1{margin:0;font-size:22px;letter-spacing:.3px;color:var(--accent)}
    .sub{color:var(--muted);font-size:13px;margin-top:6px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:#171a2e;border:1px solid var(--border);border-radius:12px;padding:14px}
    .stat{display:flex;flex-direction:column;gap:6px}
    .label{font-size:12px;color:var(--muted)}
    .value{font-size:22px;font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1 1 160px}
    .btn{background:var(--accent);color:#041021;border:none;border-radius:10px;padding:9px 13px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#2a2f57;color:var(--text)}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:#a9b0d6}
    .btn.danger{background:var(--danger);color:white}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);color:var(--muted)}
    .mini{font-size:12px;color:#a9b0d6}
    ul.clean{list-style:none;padding-left:0;margin:0}
    ul.clean li{display:flex;align-items:center;gap:8px;margin:6px 0;padding:8px;border:1px solid var(--border);border-radius:10px;background:#121633}

    .quote{background:linear-gradient(180deg,#121636,#10142a);border:1px solid var(--border);margin-bottom:16px}
    .quote blockquote{margin:0;text-align:center;line-height:1.65}
    .quote .zh{font-size:22px;letter-spacing:.05em;font-family:"Noto Sans JP","Microsoft YaHei","WenQuanYi Zen Hei",system-ui,sans-serif}
    .quote .en{margin-top:8px;color:#cfd6ff;font-size:15px;font-style:italic}

    details > summary{cursor:pointer;list-style:none}
    details > summary::-webkit-details-marker{display:none}

    /* Focus mode */
    .focus-on{position:relative;z-index:3;transform:scale(1.02);box-shadow:0 8px 28px rgba(0,0,0,.35)}
    .focus-dim{filter:brightness(var(--dim));opacity:.9}

    /* Calendar */
    .cal{display:grid;grid-template-columns:repeat(7,minmax(44px,1fr));gap:6px}
    .cal .head{font-size:12px;color:#a9b0d6;text-align:center}
    .day{display:flex;flex-direction:column;align-items:flex-end;justify-content:space-between;border:1px solid var(--border);border-radius:10px;min-height:72px;padding:6px;background:#10142e;color:var(--text);cursor:pointer}
    .day .d{font-size:12px;color:#a9b0d6;align-self:flex-start}
    .mark{align-self:flex-end;border-radius:999px;padding:2px 6px;font-size:11px;border:1px solid var(--border)}
    .mark.good{background:#122a1f;color:#7bffb8;border-color:#2b6e3b}
    .mark.bad{background:#2a121f;color:#ff9aa8;border-color:#5a2a2a}
    .mark.none{background:#121633;color:#a9b0d6}
    .day:focus-visible{outline:2px solid var(--accent)}

    /* Dock */
    .dock{position:sticky;bottom:10px;z-index:9;display:flex;justify-content:center;margin-top:16px}
    .dock-inner{backdrop-filter:blur(8px);background:rgba(16,20,42,.85);border:1px solid var(--border);border-radius:14px;padding:8px;display:flex;gap:8px;flex-wrap:wrap;max-width:1100px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:12px;border:1px solid var(--border);background:#10142a;color:#e8edff;cursor:pointer;font-size:14px}

    input,select,textarea{width:100%;background:#0e1126;color:var(--text);border:1px solid var(--border);border-radius:8px;padding:8px 10px;font:inherit}
    footer{color:var(--muted);font-size:12px;padding:24px;text-align:center}
  </style>
</head>
<body>
  <header>
    <h1>âš”ï¸ Solo Leveling â€” Weekly Gate</h1>
    <div class="sub">v3.2.1 â€¢ Fixed poem line breaks â€¢ Larger calendar tiles â€¢ Better contrast & focus.</div>
  </header>

  <div class="wrap" id="wrapRoot">
    <!-- Motivation card with proper line breaks (no \n) -->
    <div class="card quote" id="qcard">
      <blockquote>
        <div class="en">"I will continue fighting myself, as long as I have fangs in my heart."</div>
        <div class="zh" lang="ja">å·±ã®ç”Ÿã«<br>æŠ—ã„ç¶šã‘ã‚‹<br>å·±ã®å¿ƒã«<br>ç‰™ã‚ã‚‹é™ã‚Š</div>
      </blockquote>
    </div>

    <div class="grid">
      <div class="card stat" style="grid-column: span 3;">
        <div class="label">Levels Cleared (Weeks Passed)</div>
        <div class="value" id="levelsCleared">0</div>
      </div>
      <div class="card stat" style="grid-column: span 3;">
        <div class="label">This Week Gate</div>
        <div class="value" id="gateStatus">Checkingâ€¦</div>
      </div>
      <div class="card stat" style="grid-column: span 3;">
        <div class="label">Total EXP (optional)</div>
        <div class="value" id="totalExp">0</div>
      </div>
      <div class="card stat" style="grid-column: span 3;">
        <div class="label">This Week EXP</div>
        <div class="value" id="weekExp">0</div>
      </div>
    </div>

    <div class="card" id="weeklyCard" data-spotlight>
      <summary><h3 style="margin:0 0 8px">Weekly Main Quests â€” Live Progress</h3></summary>
      <ul class="clean" id="mqList"></ul>
      <div class="row" style="margin-top:8px">
        <span class="pill">Week: <span id="weekRange"></span></span>
        <button class="btn secondary" id="keywordsBtn" style="margin-left:auto">Edit keywords</button>
      </div>
    </div>

    <details open class="card" id="strengthCard" data-spotlight>
      <summary>ğŸ’ª <b>Strength Templates & Session Tracker</b></summary>
      <div class="section">
        <div class="row">
          <select id="planSelect">
            <option value="A">Plan A â€” Back/Shoulder & Abs</option>
            <option value="B">Plan B â€” Chest/Calves & Shoulder + Abs</option>
          </select>
          <input type="date" id="sessDate">
          <button class="btn" id="startSession">Start Session</button>
          <button class="btn secondary" id="clearSession">Clear</button>
          <button class="btn ghost" id="quickSetBtn">+1 Set (Quick)</button>
        </div>
        <div id="sessionBox" style="margin-top:12px;display:none">
          <div class="mini" id="sessionIntro"></div>
          <div id="exercises"></div>
          <div class="row" style="margin-top:8px">
            <textarea id="sessNotes" placeholder="Notes (warm-up, weights, how it felt)" rows="2"></textarea>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="saveSession">Save Session</button>
          </div>
        </div>

        <h4 style="margin:16px 0 8px">Saved Strength Sessions</h4>
        <table id="sessionTable">
          <thead><tr><th>Date</th><th>Plan</th><th>Total Sets</th><th>Volume</th><th>Highlights</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <details open class="card" id="cleanCard" data-spotlight>
      <summary>ğŸ¥— <b>Side Quest: Clean Boy (Daily)</b></summary>
      <div class="section">
        <div class="row">
          <input type="date" id="qDate">
          <label>Ate clean <input type="checkbox" id="qClean"></label>
          <label>Water (L) <input type="number" id="qWater" min="0" step="0.1" placeholder="2.0"></label>
          <button class="btn" id="qSave">Save Day</button>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn ghost" data-ml="100">+100 ml</button>
          <button class="btn ghost" data-ml="250">+250 ml</button>
          <button class="btn ghost" data-ml="330">+330 ml</button>
          <button class="btn ghost" data-ml="500">+500 ml</button>
          <button class="btn ghost" id="waterCustomBtn">+ custom</button>
          <div class="pill">Target: <span id="waterTargetLbl">2.0</span> L</div>
        </div>
        <div class="mini" style="margin:8px 0">Hydration progress</div>
        <div class="hbar"><span id="waterBar" style="width:0%"></span></div>
        <div class="row" style="margin-top:8px">
          <div class="pill">This month: <span id="qMonthCount">0</span> CB days</div>
          <div class="pill">Current streak: <span id="qStreak">0</span> days</div>
          <div class="pill">Best streak: <span id="qBest">0</span> days</div>
        </div>
      </div>
      <div class="section" style="padding-top:0">
        <div class="row" style="align-items:center;gap:8px">
          <button class="btn secondary" id="prevMonth">â—€</button>
          <b id="calTitle">Month YYYY</b>
          <button class="btn secondary" id="nextMonth">â–¶</button>
        </div>
        <div class="cal" id="calHead"></div>
        <div class="cal" id="calGrid"></div>
      </div>
    </details>

    <details class="card" id="workoutCard" data-spotlight>
      <summary>ğŸ‹ï¸ <b>Workout Log (freeform)</b></summary>
      <div class="section">
        <div class="row">
          <input type="date" id="wDate">
          <input type="text" id="wType" placeholder="Type (e.g., Strength, Run, Walk)">
          <input type="number" id="wDur" placeholder="Duration (min)" min="0">
          <input type="number" id="wSets" placeholder="Sets/Reps total" min="0">
          <select id="wIntens"><option value="0">Intensity (1â€‘5)</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
          <button class="btn" id="addWorkout">Add</button>
        </div>
        <table id="workoutTable" style="margin-top:12px">
          <thead><tr><th>Date</th><th>Type</th><th>Minutes</th><th>Sets/Reps</th><th>Intensity</th><th>EXP</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <details class="card" id="choreCard" data-spotlight>
      <summary>ğŸ§¹ <b>Chores & Reading Log</b></summary>
      <div class="section">
        <div class="row">
          <input type="date" id="cDate">
          <input type="text" id="cName" placeholder="Chore (e.g., Vacuum / Sweep / Dust / Bathroom / Reading)">
          <input type="number" id="cPomo" placeholder="Pomodoros" min="0">
          <input type="number" id="cMin" placeholder="Minutes" min="0">
          <button class="btn" id="addChore">Add</button>
        </div>
        <table id="choreTable" style="margin-top:12px">
          <thead><tr><th>Date</th><th>Chore</th><th>Pomodoros</th><th>Minutes</th><th>EXP</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <details class="card" id="settingsCard" data-spotlight>
      <summary>âš™ï¸ <b>Settings</b></summary>
      <div class="section">
        <div class="row">
          <label>Base Workout EXP <input id="cfgBaseWorkout" type="number" value="50"></label>
          <label>Base Chore EXP <input id="cfgBaseChore" type="number" value="20"></label>
          <label>EXP per Workout Minute <input id="cfgPerMin" type="number" value="2"></label>
          <label>Hydration target (L/day) <input id="cfgWaterTarget" type="number" step="0.1" value="2.0"></label>
        </div>
        <div class="row">
          <label>Strength keywords <input id="kwStrength" value="strength, weights, gym, lift, deadlift, squat, bench, press"></label>
          <label>Cardio keywords <input id="kwCardio" value="run, cardio, bike, cycling, swim, row"></label>
          <label>Walk keywords <input id="kwWalk" value="walk, walking"></label>
        </div>
        <div class="row">
          <label>Vacuum keywords <input id="kwVac" value="vacuum, hoover"></label>
          <label>Sweep keywords <input id="kwSweep" value="sweep, broom"></label>
          <label>Dust keywords <input id="kwDust" value="dust, dusting"></label>
          <label>Bathroom keywords <input id="kwBath" value="bathroom, toilet, wc"></label>
          <label>Reading keywords <input id="kwRead" value="read, reading, book"></label>
        </div>
        <div class="row">
          <button class="btn" id="saveCfg">Save Settings</button>
          <button class="btn secondary" id="exportBtn">Export Save</button>
          <label class="btn secondary" for="importFile" style="cursor:pointer">Import Save<input type="file" id="importFile" accept="application/json" style="display:none"></label>
          <button class="btn danger" id="resetAll">Reset Everything</button>
        </div>
      </div>
    </details>

    <div class="dock">
      <div class="dock-inner" id="dock">
        <span class="chip" id="openWorkoutModal">â• Add workout</span>
        <span class="chip" id="openChoreModal">â• Add chore</span>
        <span class="chip" id="quickCardio10">ğŸƒ +10m cardio</span>
        <span class="chip" id="quickWalk10">ğŸš¶ +10m walk</span>
        <span class="chip" data-ml="250">ğŸ’§ +250 ml</span>
        <span class="chip" data-ml="330">ğŸ’§ +330 ml</span>
        <span class="chip" data-ml="500">ğŸ’§ +500 ml</span>
        <span class="chip" id="focusToggle">ğŸ¯ Focus mode</span>
      </div>
    </div>

    <footer>+1 level only if all quests met Monâ€“Sun. Data is stored locally; sync is optional.</footer>
  </div>

  <!-- Modals (unchanged API) -->
  <div class="modal" id="workoutModal" aria-hidden="true">
    <div class="sheet">
      <h3>â• Quick add workout</h3>
      <div class="frow"><label>Type <input id="mWType" placeholder="Strength / Run / Walk"></label></div>
      <div class="frow"><label>Minutes <input id="mWMin" type="number" min="0" value="30"></label><label>Sets <input id="mWSets" type="number" min="0" value="0"></label></div>
      <div class="frow"><label>Intensity (1â€‘5) <select id="mWInt"><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option></select></label></div>
      <div class="frow"><button class="btn" id="mWSave">Add Workout</button><button class="btn secondary" id="mWClose">Cancel</button></div>
    </div>
  </div>

  <div class="modal" id="choreModal" aria-hidden="true">
    <div class="sheet">
      <h3>â• Quick add chore / reading</h3>
      <div class="frow"><label>Chore name <input id="mCName" placeholder="Vacuum / Dust / Bathroom / Reading"></label></div>
      <div class="frow"><label>Minutes <input id="mCMin" type="number" min="0" value="20"></label><label>Pomodoros <input id="mCPomo" type="number" min="0" value="0"></label></div>
      <div class="frow"><button class="btn" id="mCSave">Add Chore</button><button class="btn secondary" id="mCClose">Cancel</button></div>
    </div>
  </div>

  <script src="app.js?v=321"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js?v=321');
      });
    }
  </script>
</body>
</html>
